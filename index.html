<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>伦敦小红书博主探店预约解析器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate-50 */
        }

        /* 自定义滚动条 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 选中状态的卡片样式 */
        .checkbox-card:has(input:checked) {
            background-color: #eff6ff; /* blue-50 */
            border-color: #3b82f6; /* blue-500 */
            color: #1e40af; /* blue-800 */
        }

        /* 移动端优化 */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
    </style>
</head>
<body class="text-slate-600 antialiased min-h-screen flex flex-col">

<div class="w-full bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
    <div class="container mx-auto max-w-6xl px-4 h-16 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-indigo-200 shadow-lg">
                R
            </div>
            <h1 class="text-lg md:text-xl font-bold text-slate-800 truncate hidden sm:block">
                伦敦小红书博主探店预约解析器
            </h1>
        </div>

        <div class="flex items-center gap-2">
            <a href="https://jinshuju.net/forms/PdJXLA/entries" target="_blank" rel="noopener noreferrer"
               class="text-xs md:text-sm font-medium text-pink-600 hover:text-pink-800 bg-pink-50 hover:bg-pink-100 px-3 py-2 rounded-full transition-colors duration-200 flex items-center gap-1 border border-transparent hover:border-pink-200">
               <span>Instagram后台</span>
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                </svg>
            </a>

            <a href="https://jinshuju.net/forms/Mhc1wf/entries" target="_blank" rel="noopener noreferrer"
               class="text-xs md:text-sm font-medium text-indigo-600 hover:text-indigo-800 bg-indigo-50 hover:bg-indigo-100 px-3 py-2 rounded-full transition-colors duration-200 flex items-center gap-1 border border-transparent hover:border-indigo-200">
               <span>小红书后台</span>
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                </svg>
            </a>
        </div>

    </div>
</div>

<div class="container mx-auto max-w-6xl py-6 md:py-8 flex-grow">

<!--    <div class="bg-gradient-to-r from-indigo-600 to-blue-500 rounded-2xl p-6 mb-8 shadow-xl text-white flex flex-col md:flex-row items-center justify-between relative overflow-hidden">-->
<!--        <div class="z-10 text-center md:text-left mb-4 md:mb-0">-->
<!--            <h2 class="text-2xl font-bold mb-2">伦敦小红书博主探店预约解析器</h2>-->
<!--            <p class="text-indigo-100 text-sm md:text-base opacity-90">快速解析 Excel 数据，生成格式化预约清单。</p>-->
<!--        </div>-->
<!--        <div class="z-10 flex-shrink-0 bg-white/20 backdrop-blur-sm p-2 rounded-full">-->
<!--             <img src="https://s3.getstickerpack.com/storage/uploads/sticker-pack/xiong-mao-yi-erdi-shi-yi-dan-yi-er-2/sticker_3.gif?5cd401841fd0e7049c21f8e0ab80da99&d=80x80" class="w-12 h-12 md:w-16 md:h-16 rounded-full">-->
<!--        </div>-->
<!--        <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-10 rounded-full blur-3xl"></div>-->
<!--        <div class="absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-indigo-900 opacity-20 rounded-full blur-3xl"></div>-->
<!--    </div>-->

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

        <aside class="lg:col-span-4 space-y-6">

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center gap-2">
                    <div class="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold">1</div>
                    <h3 class="font-semibold text-slate-700">数据源</h3>
                </div>

                <div class="p-5 space-y-5">
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">A. 在线文件 URL</label>
                        <div class="flex gap-2">
                            <input type="text" id="url-input"
                                   placeholder="粘贴 https://..."
                                   class="flex-1 text-sm text-slate-700 border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all shadow-sm">
                        </div>
                        <button id="load-url-btn"
                                class="mt-2 w-full bg-white border border-blue-600 text-blue-600 hover:bg-blue-50 font-medium py-2 px-4 rounded-lg shadow-sm transition-all duration-200 text-sm active:scale-[0.98]">
                            <span class="flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                                </svg>
                                加载 URL 数据
                            </span>
                        </button>
                    </div>

                    <div class="relative flex py-1 items-center">
                        <div class="flex-grow border-t border-slate-200"></div>
                        <span class="flex-shrink-0 mx-4 text-slate-300 text-xs font-medium">OR</span>
                        <div class="flex-grow border-t border-slate-200"></div>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">B. 本地 Excel/CSV</label>
                        <label id="drop-zone" class="flex flex-col items-center justify-center w-full h-24 border-2 border-slate-300 border-dashed rounded-xl cursor-pointer bg-slate-50 hover:bg-slate-100 transition-all duration-200">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6 pointer-events-none">
                                <svg class="w-8 h-8 mb-2 text-slate-400 transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                <p class="text-xs text-slate-500"><span class="font-semibold">点击上传</span> 或拖拽文件</p>
                            </div>
                            <input type="file" id="file-upload" class="hidden" accept=".xlsx, .xls, .csv" />
                        </label>
                    </div>

                    <div id="loading-spinner" class="hidden flex items-center justify-center text-sm text-blue-600 gap-2 bg-blue-50 p-2 rounded-lg">
                        <svg class="animate-spin h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        正在解析...
                    </div>
                    <div id="error-message" class="hidden text-sm text-red-600 bg-red-50 p-3 rounded-lg border border-red-100"></div>
                    <div id="success-message" class="hidden text-sm text-emerald-600 bg-emerald-50 p-3 rounded-lg border border-emerald-100 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
                        解析成功
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xs font-bold">2</div>
                        <h3 class="font-semibold text-slate-700">目标餐厅</h3>
                    </div>
                </div>
                <div id="restaurant-list-container" class="h-48 overflow-y-auto p-2 space-y-1 bg-white custom-scrollbar">
                    <div class="h-full flex flex-col items-center justify-center text-slate-400 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mb-2 opacity-50">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21" />
                        </svg>
                        请先加载数据
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center gap-2">
                     <div class="w-6 h-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs font-bold">3</div>
                     <h3 class="font-semibold text-slate-700">筛选与显示</h3>
                </div>

                <div class="p-4">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">数据过滤</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-6">
                        <label class="checkbox-card flex items-center p-3 border border-slate-200 rounded-lg cursor-pointer transition-all">
                            <input type="checkbox" id="filter-exclude-sent" checked class="accent-indigo-600 w-4 h-4">
                            <span class="ml-2 text-sm font-medium">排除“已发送”</span>
                        </label>
                        <label class="checkbox-card flex items-center p-3 border border-slate-200 rounded-lg cursor-pointer transition-all">
                            <input type="checkbox" id="filter-over-10k" class="accent-indigo-600 w-4 h-4">
                            <span class="ml-2 text-sm font-medium">只看万粉 (10k+)</span>
                        </label>
                        <label class="checkbox-card flex items-center p-3 border border-slate-200 rounded-lg cursor-pointer transition-all">
                            <input type="checkbox" id="filter-this-week" class="accent-indigo-600 w-4 h-4">
                            <span class="ml-2 text-sm font-medium">只看本周</span>
                        </label>
                        <label class="checkbox-card flex items-center p-3 border border-slate-200 rounded-lg cursor-pointer transition-all">
                            <input type="checkbox" id="filter-next-week" class="accent-indigo-600 w-4 h-4">
                            <span class="ml-2 text-sm font-medium">只看下周</span>
                        </label>
                    </div>

                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">字段显示</p>
                    <div class="flex flex-wrap gap-2">

                        <label class="group inline-flex items-center px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 cursor-pointer hover:bg-slate-50 has-[:checked]:bg-indigo-50 has-[:checked]:text-indigo-700 has-[:checked]:border-indigo-200 transition-all">
                            <input type="checkbox" id="display-restaurant" checked class="hidden peer">
                            <svg class="w-4 h-4 mr-1.5 text-slate-400 group-has-[:checked]:text-indigo-600 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349m-16.5 11.65V9.35m0 0a3.001 3.001 0 003.75-.615A2.993 2.993 0 009.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 002.25 1.016c.896 0 1.7-.393 2.25-1.016a3.001 3.001 0 003.75.614m-16.5 0a3.004 3.004 0 01-.621-4.72L4.318 3.44A1.5 1.5 0 015.378 3h13.243a1.5 1.5 0 011.06.44l1.19 1.189a3 3 0 01-.621 4.72m-13.5 8.65h3.75a.75.75 0 00.75-.75V13.5a.75.75 0 00-.75-.75H6.75a.75.75 0 00-.75.75v3.75c0 .415.336.75.75.75z" />
                            </svg>
                            餐厅
                        </label>

                        <label class="group inline-flex items-center px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 cursor-pointer hover:bg-slate-50 has-[:checked]:bg-indigo-50 has-[:checked]:text-indigo-700 has-[:checked]:border-indigo-200 transition-all">
                            <input type="checkbox" id="display-link" checked class="hidden peer">
                            <svg class="w-4 h-4 mr-1.5 text-slate-400 group-has-[:checked]:text-indigo-600 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" />
                            </svg>
                            链接
                        </label>

                        <label class="group inline-flex items-center px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 cursor-pointer hover:bg-slate-50 has-[:checked]:bg-indigo-50 has-[:checked]:text-indigo-700 has-[:checked]:border-indigo-200 transition-all">
                            <input type="checkbox" id="display-people-count" checked class="hidden peer">
                            <svg class="w-4 h-4 mr-1.5 text-slate-400 group-has-[:checked]:text-indigo-600 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                            </svg>
                            人数
                        </label>

                        <label class="group inline-flex items-center px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 cursor-pointer hover:bg-slate-50 has-[:checked]:bg-indigo-50 has-[:checked]:text-indigo-700 has-[:checked]:border-indigo-200 transition-all">
                            <input type="checkbox" id="display-status" class="hidden peer">
                            <svg class="w-4 h-4 mr-1.5 text-slate-400 group-has-[:checked]:text-indigo-600 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                            </svg>
                            状态
                        </label>

                        <label class="group inline-flex items-center px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 cursor-pointer hover:bg-slate-50 has-[:checked]:bg-indigo-50 has-[:checked]:text-indigo-700 has-[:checked]:border-indigo-200 transition-all">
                            <input type="checkbox" id="display-phone" class="hidden peer">
                            <svg class="w-4 h-4 mr-1.5 text-slate-400 group-has-[:checked]:text-indigo-600 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                            </svg>
                            手机
                        </label>

                        <label class="group inline-flex items-center px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 cursor-pointer hover:bg-slate-50 has-[:checked]:bg-indigo-50 has-[:checked]:text-indigo-700 has-[:checked]:border-indigo-200 transition-all">
                            <input type="checkbox" id="display-email" class="hidden peer">
                            <svg class="w-4 h-4 mr-1.5 text-slate-400 group-has-[:checked]:text-indigo-600 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                            </svg>
                            邮箱
                        </label>
                    </div>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-8 flex flex-col h-full">
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 flex flex-col flex-grow overflow-hidden">

                <div class="bg-white px-5 py-3 border-b border-slate-100 flex items-center justify-between flex-shrink-0 h-16">
                    <h2 id="results-label" class="text-lg font-semibold text-slate-800 flex items-center gap-2 truncate mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-indigo-500 flex-shrink-0">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                        </svg>
                        <span>解析结果</span>
                    </h2>

                    <button id="copy-results-btn"
                        class="flex-shrink-0 bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm shadow-emerald-100 transition-all duration-200 flex items-center gap-2 active:scale-[0.98] text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5A3.375 3.375 0 006.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0015 2.25h-1.5a2.251 2.251 0 00-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 00-9-9z" />
                        </svg>
                        <span class="hidden sm:inline">一键复制</span>
                        <span class="sm:hidden">复制</span>
                    </button>
                </div>

                <div class="relative flex-grow bg-slate-50 p-4 overflow-hidden flex flex-col">
                    <pre id="results-output"
                         class="w-full h-full overflow-y-auto text-sm text-slate-700 whitespace-pre-wrap font-mono custom-scrollbar p-2 leading-relaxed select-all border border-slate-100 rounded-lg bg-white shadow-sm"
                         style="min-height: 300px;"></pre>
                </div>

            </div>
        </main>
    </div>

    <div class="text-center mt-8 pb-4 text-slate-400 text-sm font-mono">
        JZP Exclusively Made For KYS
    </div>

</div>

<script>
    // --- 全局变量 ---
    let globalData = [];

    // [Gemini 修改] 新增 '预约人数' 到必需列
    const requiredCols = [
        '预约日期', '小红书名', '小红书粉丝数', '预约餐厅',
        '已发送给店家', '小红书链接', '手机', '邮箱', '预约人数'
    ];

    const WEEKDAY_MAP_JS = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
    const numberFormatter = new Intl.NumberFormat('en-US');

    // --- DOM 元素引用 ---
    const urlInput = document.getElementById('url-input');
    const loadUrlBtn = document.getElementById('load-url-btn');
    const fileInput = document.getElementById('file-upload');
    // [新增] 拖拽区 ID
    const dropZone = document.getElementById('drop-zone');

    const loadingSpinner = document.getElementById('loading-spinner');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const restaurantContainer = document.getElementById('restaurant-list-container');
    const resultsLabel = document.getElementById('results-label');
    const resultsOutput = document.getElementById('results-output');

    const filterExcludeSent = document.getElementById('filter-exclude-sent');
    const filterThisWeek = document.getElementById('filter-this-week');
    const filterNextWeek = document.getElementById('filter-next-week');
    const filterOver10k = document.getElementById('filter-over-10k');

    const displayRestaurant = document.getElementById('display-restaurant');
    const displayLink = document.getElementById('display-link');
    const displayStatus = document.getElementById('display-status');
    const displayPhone = document.getElementById('display-phone');
    const displayEmail = document.getElementById('display-email');
    const displayPeopleCount = document.getElementById('display-people-count');

    const copyBtn = document.getElementById('copy-results-btn');


    // --- 事件监听 ---

    loadUrlBtn.addEventListener('click', handleUrlLoad);
    fileInput.addEventListener('change', handleFileSelect);

    // [新增] 拖拽相关的事件监听
    if (dropZone) {
        // 阻止默认行为
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        // 视觉反馈
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.add('border-indigo-400', 'bg-indigo-50', 'border-solid');
                dropZone.classList.remove('border-slate-300', 'border-dashed', 'bg-slate-50');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.remove('border-indigo-400', 'bg-indigo-50', 'border-solid');
                dropZone.classList.add('border-slate-300', 'border-dashed', 'bg-slate-50');
            }, false);
        });

        // 处理拖放
        dropZone.addEventListener('drop', handleDrop, false);
    }


    // 2. 监听所有 *普通* 筛选/显示选项的变化
    [
        filterExcludeSent,
        filterOver10k,
        displayRestaurant, displayLink, displayStatus, displayPhone, displayEmail,
        displayPeopleCount
    ].forEach(checkbox => {
        if (checkbox) { // 确保元素存在
            checkbox.addEventListener('change', updateDisplay);
        }
    });

    // 3. "本周" 和 "下周" 筛选的互斥逻辑和单独的监听
    if (filterThisWeek && filterNextWeek) {
        filterThisWeek.addEventListener('change', () => {
            if (filterThisWeek.checked) {
                filterNextWeek.checked = false;
            }
            updateDisplay();
        });

        filterNextWeek.addEventListener('change', () => {
            if (filterNextWeek.checked) {
                filterThisWeek.checked = false;
            }
            updateDisplay();
        });
    }

    // 4. 监听餐厅列表
    restaurantContainer.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox') {
            updateDisplay();
        }
    });

    // 5. 监听复制按钮
    copyBtn.addEventListener('click', copyResultsToClipboard);


    // --- 核心功能函数 ---

    // [新增] 阻止浏览器默认行为
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // [新增] 处理 Drop 事件
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files && files.length > 0) {
            processFile(files[0]);
        }
    }

    // [修改] 处理点击上传
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        processFile(file);
        // 清空 value 以允许重复上传同名文件
        event.target.value = null;
    }

    // [重构] 核心文件解析逻辑，供 handleDrop 和 handleFileSelect 复用
    function processFile(file) {
        resetUIForLoading('正在解析本地文件...');
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = e.target.result;
                parseExcelData(data);
            } catch (err) {
                showError(`文件解析失败: ${err.message}`);
                loadingSpinner.classList.add('hidden');
            }
        };
        reader.onerror = () => {
            showError('读取文件失败。');
            loadingSpinner.classList.add('hidden');
        };
        reader.readAsArrayBuffer(file);
    }

    function resetUIForLoading(message) {
        loadingSpinner.innerHTML = `<svg class="animate-spin h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ${message}`;
        loadingSpinner.classList.remove('hidden');
        errorMessage.classList.add('hidden');
        successMessage.classList.add('hidden');
        restaurantContainer.innerHTML = `<div class="h-full flex items-center justify-center text-slate-400 text-sm">${message}</div>`;
        resultsOutput.textContent = '';
        // resultsLabel.textContent = '5. 解析结果：'; // 保持新UI的标题不动
        globalData = [];
    }

    async function handleUrlLoad() {
        const url = urlInput.value.trim();
        if (!url) {
            showError('请输入有效的 URL。');
            return;
        }
        resetUIForLoading('正在下载和解析 URL...');
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`网络请求失败 (HTTP ${response.status})`);
            }
            const data = await response.arrayBuffer();
            parseExcelData(data);
        } catch (err) {
            console.error("加载 URL 失败:", err);
            if (err instanceof TypeError && err.message.includes('Failed to fetch')) {
                showError('加载失败：可能是跨域 (CORS) 限制。');
            } else {
                showError(`文件加载或解析失败: ${err.message}`);
            }
            loadingSpinner.classList.add('hidden');
        }
    }

    function parseExcelData(data) {
         try {
            const workbook = XLSX.read(data, { type: 'array', cellDates: true });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const dataAsArray = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            processData(dataAsArray);
        } catch (err) {
            showError(`Excel 解析失败: ${err.message}`);
            loadingSpinner.classList.add('hidden');
        }
    }

    function processData(dataAsArray) {
        if (dataAsArray.length < 2) {
            showError('表格为空或只有表头。');
            loadingSpinner.classList.add('hidden');
            return;
        }
        const rawHeaders = dataAsArray[0];
        const headers = rawHeaders.map(h => {
            if (h == null) return '';
            return String(h).replace(/\ufeff/g, '').trim();
        });

        // 检查 'requiredCols' (现在包含 '预约人数')
        const missingCols = requiredCols.filter(col => !headers.includes(col));
        if (missingCols.length > 0) {
            console.log("找到的表头:", headers);
            console.log("需要的表头:", requiredCols);
            showError(`Excel 缺少必需列: ${missingCols.join(', ')}`);
            loadingSpinner.classList.add('hidden');
            return;
        }

        let uniqueRestaurants = new Set();
        globalData = [];
        const colIndexMap = {};

        // 这会
        requiredCols.forEach(reqCol => {
            const index = headers.indexOf(reqCol);
            if (index !== -1) {
                colIndexMap[reqCol] = index;
            }
        });

        const dataRows = dataAsArray.slice(1);
        dataRows.forEach((row, index) => {
            const dtValue = row[colIndexMap['预约日期']];
            let dt = null;
            if (dtValue instanceof Date) {
                dt = dtValue;
            } else if (typeof dtValue === 'number') {
                dt = XLSX.SSF.parse_date_code(dtValue);
            } else if (typeof dtValue === 'string') {
                dt = new Date(dtValue);
            }

            const restaurantName = row[colIndexMap['预约餐厅']];
            if (dt && !isNaN(dt.getTime())) {
                let trimmedRestaurantName = null;
                if (restaurantName) {
                    trimmedRestaurantName = String(restaurantName).trim();
                    if(trimmedRestaurantName) {
                        uniqueRestaurants.add(trimmedRestaurantName);
                    }
                }

                // [Gemini 注释]
                // 因为 '预约人数' 已经在 requiredCols 中,
                // 下面的循环会自动将其从 row 复制到 normalizedRow
                const normalizedRow = {};
                for (const reqCol in colIndexMap) {
                    normalizedRow[reqCol] = row[colIndexMap[reqCol]];
                }

                globalData.push({
                    ...normalizedRow,
                    '预约日期_dt': dt,
                    '预约餐厅': trimmedRestaurantName
                });
            }
        });
        globalData.sort((a, b) => a['预约日期_dt'] - b['预约日期_dt']);
        loadingSpinner.classList.add('hidden');
        showSuccess(`解析成功：共发现 ${uniqueRestaurants.size} 家餐厅。`);
        populateCheckboxes(uniqueRestaurants);
        updateDisplay();
    }

    function populateCheckboxes(restaurantSet) {
        const sortedRestaurants = Array.from(restaurantSet).filter(name => name && name.trim() !== "").sort();
        if (sortedRestaurants.length === 0) {
            restaurantContainer.innerHTML = '<span class="text-slate-500 text-sm p-4">未在文件中找到餐厅。</span>';
            return;
        }
        let html = '';
        sortedRestaurants.forEach((name, index) => {
            const id = `restaurant-chk-${index}`;
            // 美化后的 Checkbox 列表项
            html += `
                <label class="flex items-center p-2 rounded hover:bg-slate-50 cursor-pointer transition-colors group">
                    <input type="checkbox" id="${id}" value="${name}" class="restaurant-checkbox w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                    <span class="ml-2 text-sm text-slate-700 group-hover:text-indigo-700 transition-colors">${name}</span>
                </label>
            `;
        });
        restaurantContainer.innerHTML = html;
    }

    /**
     * 4. 核心筛选/显示函数
     */
    function updateDisplay() {
        if (globalData.length === 0) {
            resultsLabel.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-indigo-500 flex-shrink-0">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
                <span>解析结果 (0)</span>
            `;
            resultsOutput.textContent = '';
            return;
        }

        // A. 获取所有选中的餐厅
        const selectedRestaurants = Array.from(
            restaurantContainer.querySelectorAll('.restaurant-checkbox:checked')
        ).map(cb => cb.value);

        // B. 获取筛选选项
        const bExcludeSent = filterExcludeSent.checked;
        const bThisWeek = filterThisWeek.checked;
        const bNextWeek = filterNextWeek.checked;
        const bOver10k = filterOver10k.checked;

        // C. 获取显示选项
        const bShowRestaurant = displayRestaurant.checked;
        const bShowLink = displayLink.checked;
        const bShowStatus = displayStatus.checked;
        const bShowPhone = displayPhone.checked;
        const bShowEmail = displayEmail.checked;
        // [Gemini 新增] 获取“预约人数”的显示状态
        const bShowPeopleCount = displayPeopleCount.checked;


        // --- D. 开始筛选 ---
        let filteredData = [];

        // 1. 按餐厅筛选
        if (selectedRestaurants.length > 0) {
            filteredData = globalData.filter(row =>
                selectedRestaurants.includes(row['预约餐厅'])
            );
        } else {
            filteredData = [];
        }

        // 2. 按“排除已发送”筛选
        if (bExcludeSent) {
            filteredData = filteredData.filter(row => {
                const status = row['已发送给店家'];
                return status == null || status === '否' || status === false || String(status).trim() === '';
            });
        }

        // 3. 按“周”筛选
        if (bThisWeek) {
            const { start, end } = getThisWeekRange();
            filteredData = filteredData.filter(row => {
                const apptDate = row['预约日期_dt'];
                return apptDate >= start && apptDate <= end;
            });
        } else if (bNextWeek) {
            const { start, end } = getNextWeekRange();
            filteredData = filteredData.filter(row => {
                const apptDate = row['预约日期_dt'];
                return apptDate >= start && apptDate <= end;
            });
        }

        // 4. 按“只看万粉”筛选
        if (bOver10k) {
            filteredData = filteredData.filter(row => {
                const followers = parseInt(row['小红书粉丝数'], 10);
                return !isNaN(followers) && followers >= 10000;
            });
        }

        // --- E. 格式化输出 ---
        // [Gemini 修改] 传入 bShowPeopleCount
        const resultString = formatDataToString(
            filteredData,
            bShowRestaurant,
            bShowLink,
            bShowStatus,
            bShowPhone,
            bShowEmail,
            bShowPeopleCount
        );

        // F. 更新 UI
        resultsLabel.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-indigo-500 flex-shrink-0">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
            </svg>
            <span>解析结果 (${filteredData.length})</span>
        `;
        resultsOutput.textContent = resultString;
    }

    /**
     * 5. 将筛选后的数据格式化为最终字符串
     */
    // [Gemini 修改] 新增 showPeopleCount 参数
    function formatDataToString(data, showRestaurant, showLink, showStatus, showPhone, showEmail, showPeopleCount) {
        if (data.length === 0) {
            return '没有找到匹配所选筛选条件的预约记录。';
        }

        const outputLines = data.map(row => {
            const recordLines = [];
            const dt = row['预约日期_dt'];

            // 1. 日期、星期、时间 (始终显示)
            const dateStr = `${dt.getMonth() + 1}月${dt.getDate()}日`;
            const dayStr = `（${WEEKDAY_MAP_JS[dt.getDay()]}）`;
            const timeStr = formatTimeAMPM(dt);
            recordLines.push(`- ${dateStr}${dayStr} ${timeStr}`);

            // 2. 餐厅 (条件显示)
            if (showRestaurant) {
                recordLines.push(`- 餐厅：${row['预约餐厅'] || '(空)'}`);
            }

            // 3. 博主 (始终显示)
            recordLines.push(`- 博主：${row['小红书名'] || '(空)'}`);

            // 4. 链接 (条件显示)
            if (showLink) {
                const link = row['小红书链接'];
                const linkStr = (link && String(link).trim() !== '') ? link : '(空)';
                recordLines.push(`- 链接：${linkStr}`);
            }

            // 5. 粉丝量 (始终显示)
            try {
                const count = parseInt(row['小红书粉丝数'], 10);
                let followerStr = isNaN(count) ? row['小红书粉丝数'] : numberFormatter.format(count);

                if (!isNaN(count) && count >= 10000) {
                    followerStr += ' ⭐️'; // 添加五角星
                }

                recordLines.push(`- 粉丝量：${followerStr || '0'}`);
            } catch (e) {
                recordLines.push(`- 粉丝量：${row['小红书粉丝数'] || '(错误)'}`);
            }

            // 6. [Gemini 新增] 预约人数 (条件显示)
            if (showPeopleCount) {
                const people = row['预约人数'];
                recordLines.push(`- 预约人数：${people || '(空)'}`);
            }

            // 7. 状态 (条件显示)
            if (showStatus) {
                const status = row['已发送给店家'];
                let statusStr = "未知";
                if (status == null || String(status).trim() === '') {
                    statusStr = "未发送";
                } else if (status === '否' || status === false) {
                    statusStr = "未发送";
                } else if (status === '是' || status === true) {
                    statusStr = "已发送";
                } else {
                    statusStr = String(status);
                }
                recordLines.push(`- 状态：${statusStr}`);
            }

            // 8. 手机 (条件显示)
            if (showPhone) {
                const phone = row['手机'];
                recordLines.push(`- 手机：${phone || '(空)'}`);
            }

            // 9. 邮箱 (条件显示)
            if (showEmail) {
                const email = row['邮箱'];
                recordLines.push(`- 邮箱：${email || '(空)'}`);
            }

            return recordLines.join('\n');
        });

        return outputLines.join('\n\n');
    }


    // --- 辅助工具函数 ---

    function getThisWeekRange() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const dayOfWeek = today.getDay();
        const daysToSubtract = (dayOfWeek === 0) ? 6 : (dayOfWeek - 1);
        const thisMonday = new Date(today.getTime());
        thisMonday.setDate(today.getDate() - daysToSubtract);
        const thisSunday = new Date(thisMonday.getTime());
        thisSunday.setDate(thisMonday.getDate() + 6);
        thisSunday.setHours(23, 59, 59, 999);
        return { start: thisMonday, end: thisSunday };
    }

    function getNextWeekRange() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const dayOfWeek = today.getDay();
        const daysToAdd = (dayOfWeek === 0) ? 1 : (8 - dayOfWeek);
        const nextMonday = new Date(today.getTime());
        nextMonday.setDate(today.getDate() + daysToAdd);
        const nextSunday = new Date(nextMonday.getTime());
        nextSunday.setDate(nextMonday.getDate() + 6);
        nextSunday.setHours(23, 59, 59, 999);
        return { start: nextMonday, end: nextSunday };
    }

    async function copyResultsToClipboard() {
        const textToCopy = resultsOutput.textContent;
        if (!navigator.clipboard) {
            try {
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyFeedback(copyBtn, '<span class="hidden sm:inline">已复制 (备用)！</span><span class="sm:hidden">成功</span>');
            } catch (err) {
                console.error('备用复制方法失败: ', err);
                showCopyFeedback(copyBtn, "失败", true);
            }
            return;
        }
        try {
            await navigator.clipboard.writeText(textToCopy);
            showCopyFeedback(copyBtn, '<span class="hidden sm:inline">已复制！</span><span class="sm:hidden">成功</span>');
        } catch (err)
            {
            console.error('复制到剪贴板失败: ', err);
            showCopyFeedback(copyBtn, "失败", true);
        }
    }

    function showCopyFeedback(button, messageHTML, isError = false) {
        const originalHTML = button.innerHTML; // 保存原始HTML以保留图标
        const originalClasses = button.className;

        button.innerHTML = messageHTML;
        button.className = originalClasses.replace(/bg-emerald-600|hover:bg-emerald-700|bg-red-600/g, '');

        if(isError) {
             button.classList.add('bg-red-600');
             button.classList.add('text-white');
        } else {
             button.classList.add('bg-slate-600');
             button.classList.add('text-white');
        }

        button.disabled = true;
        setTimeout(() => {
            button.innerHTML = originalHTML; // 恢复图标和文字
            button.className = originalClasses;
            button.disabled = false;
        }, 1500);
    }

    function formatTimeAMPM(date) {
        let hours = date.getHours();
        let minutes = date.getMinutes();
        const ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12;
        hours = hours ? hours : 12;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        return `${hours}:${minutes}${ampm}`;
    }

    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.remove('hidden');
        successMessage.classList.add('hidden');
        loadingSpinner.classList.add('hidden');
    }

    function showSuccess(message) {
        successMessage.textContent = message;
        successMessage.classList.remove('hidden');
        errorMessage.classList.add('hidden');
    }
</script>
</body>
</html>
